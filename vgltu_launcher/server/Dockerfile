FROM python:3.11-slim

# –û—Ç–∫–ª—é—á–∞–µ–º –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é –≤—ã–≤–æ–¥–∞ (—á—Ç–æ–±—ã –ª–æ–≥–∏ –≤–∏–¥–µ—Ç—å —Å—Ä–∞–∑—É)
ENV PYTHONUNBUFFERED=1

WORKDIR /app

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º postgresql-client –∏ redis-tools
RUN apt-get update && \
    apt-get install -y postgresql-client redis-tools && \
    rm -rf /var/lib/apt/lists/*

# –°–Ω–∞—á–∞–ª–∞ –∫–æ–ø–∏—Ä—É–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ª–æ–µ–≤ Docker)
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
COPY . .
# –ö–æ–ø–∏—Ä—É–µ–º —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ (–µ—Å–ª–∏ –æ–Ω –Ω–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª—Å—è —Ç–æ—á–∫–æ–π –≤—ã—à–µ)
COPY entrypoint.sh .
# üî• –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã —Å—Ç—Ä–æ–∫ (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –∑–∞–±—ã–ª –ø.2) –∏ –¥–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø—É—Å–∫
RUN sed -i 's/\r$//g' /app/entrypoint.sh && chmod +x /app/entrypoint.sh

# –ó–∞–ø—É—Å–∫–∞–µ–º
ENTRYPOINT ["/app/entrypoint.sh"]